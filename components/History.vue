<script>
/* eslint-disable vue/no-v-html */
import { format } from 'date-fns'

import { pt } from 'date-fns/locale'

export default {
  name: 'History',
  props: {
    itemPos: {
      type: Number,
      default: 0,
    },
    item: {
      type: Object,
      default: null,
    },
  },
  methods: {
    formatDate(itemDate, opt) {
      if (!opt) {
        const date = format(new Date(itemDate), '	PPP', {
          locale: pt,
        })
        return date.substr(0, date.length - 8)
      } else
        return format(new Date(itemDate), 'dd MMM yyyy - HH:mm', {
          locale: pt,
        })
    },
    renderTransactionIcon(status) {
      switch (status) {
        case 'COMPLETED':
          return `<div class="p-1.5 bg-blue-50 rounded-full">
              <svg
                width="20"
                height="17"
                viewBox="0 0 20 17"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M16.2066 11.4915C15.9352 11.4401 15.6737 11.6185 15.6224 11.8898C15.571 12.1611 15.7494 12.4227 16.0207 12.474L16.2066 11.4915ZM6.08116 12.2781C6.35497 12.2422 6.54785 11.9912 6.51199 11.7174C6.47613 11.4436 6.22509 11.2507 5.95129 11.2866L6.08116 12.2781ZM4.19005 0.737915C3.91391 0.737915 3.69005 0.961773 3.69005 1.23792C3.69005 1.51406 3.91391 1.73792 4.19005 1.73792V0.737915ZM10.1911 11.4989C10.1911 11.7751 10.4149 11.9989 10.6911 11.9989C10.9672 11.9989 11.1911 11.7751 11.1911 11.4989H10.1911ZM10.3453 12.0267C10.1459 12.2177 10.1389 12.5342 10.3299 12.7337C10.5208 12.9331 10.8373 12.9401 11.0368 12.7491L10.3453 12.0267ZM13.823 10.0821C14.0225 9.89116 14.0294 9.57465 13.8384 9.37517C13.6475 9.17569 13.331 9.16877 13.1315 9.35972L13.823 10.0821ZM8.25067 9.35972C8.05119 9.16877 7.73468 9.17569 7.54373 9.37517C7.35278 9.57465 7.3597 9.89116 7.55918 10.0821L8.25067 9.35972ZM10.3453 12.7491C10.5448 12.9401 10.8613 12.9331 11.0523 12.7337C11.2432 12.5342 11.2363 12.2177 11.0368 12.0267L10.3453 12.7491ZM4.19005 1.73792C4.46619 1.73792 4.69005 1.51406 4.69005 1.23792C4.69005 0.961773 4.46619 0.737915 4.19005 0.737915V1.73792ZM2.05578 0.737915C1.77963 0.737915 1.55578 0.961773 1.55578 1.23792C1.55578 1.51406 1.77963 1.73792 2.05578 1.73792V0.737915ZM16.0207 12.474C17.0144 12.662 17.7963 12.8938 18.3169 13.1427C18.5784 13.2676 18.748 13.3847 18.8454 13.482C18.9416 13.578 18.9324 13.6172 18.9324 13.6033H19.9324C19.9324 13.2625 19.7616 12.9836 19.5519 12.7743C19.3436 12.5663 19.0632 12.391 18.7481 12.2404C18.1157 11.9382 17.2381 11.6866 16.2066 11.4915L16.0207 12.474ZM18.9324 13.6033C18.9324 13.5918 18.9396 13.6199 18.8745 13.6938C18.8066 13.7708 18.6837 13.869 18.4846 13.9783C18.0868 14.1966 17.4782 14.4091 16.6833 14.5936C15.1015 14.9609 12.8913 15.1927 10.4324 15.1927L10.4324 16.1927C12.9442 16.1927 15.2339 15.9567 16.9095 15.5677C17.7433 15.3742 18.4526 15.1365 18.9657 14.8549C19.2221 14.7142 19.4528 14.55 19.6247 14.355C19.7993 14.1568 19.9324 13.9032 19.9324 13.6033H18.9324ZM10.4324 15.1927C7.97359 15.1927 5.76332 14.9609 4.18154 14.5936C3.38666 14.4091 2.77802 14.1966 2.38028 13.9783C2.18119 13.869 2.05827 13.7708 1.99037 13.6938C1.92526 13.6199 1.93243 13.5918 1.93243 13.6033H0.932434C0.932434 13.9032 1.06553 14.1568 1.2402 14.355C1.41207 14.55 1.64278 14.7142 1.89912 14.8549C2.41223 15.1365 3.12161 15.3742 3.9554 15.5677C5.63099 15.9567 7.92071 16.1927 10.4324 16.1927L10.4324 15.1927ZM1.93243 13.6033C1.93243 13.6205 1.9213 13.5587 2.0833 13.4242C2.24077 13.2934 2.50159 13.1472 2.87953 13.0002C3.63062 12.708 4.73228 12.4548 6.08116 12.2781L5.95129 11.2866C4.56392 11.4683 3.37368 11.7349 2.51695 12.0682C2.09097 12.234 1.71889 12.427 1.44444 12.6549C1.17451 12.879 0.932434 13.1954 0.932434 13.6033H1.93243ZM4.19005 1.73792C7.52515 1.73792 10.1911 4.32056 10.1911 7.46092H11.1911C11.1911 3.72753 8.03579 0.737915 4.19005 0.737915V1.73792ZM10.1911 7.46092V11.4989H11.1911V7.46092H10.1911ZM11.0368 12.7491L13.823 10.0821L13.1315 9.35972L10.3453 12.0267L11.0368 12.7491ZM7.55918 10.0821L10.3453 12.7491L11.0368 12.0267L8.25067 9.35972L7.55918 10.0821ZM4.19005 0.737915L2.05578 0.737915V1.73792L4.19005 1.73792V0.737915Z"
                  fill="#1A93DA"
                />
              </svg>
            </div>`
        case 'REFUNDED':
          return `<div class="p-1.5 bg-blue-50 rounded-full">
              <svg
                width="18"
                height="17"
                viewBox="0 0 18 17"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <mask id="path-1-inside-1" fill="white">
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M2.18279 4.53948H12.0561H12.0561C15.0773 4.53948 17.5 7.14425 17.5 10.2703V10.2703C17.5 13.3964 15.0773 16.0012 12.0561 16.0012C12.0548 16.0012 12.0534 16.0012 12.0521 16.0012H1.00001C0.723867 16.0012 0.50001 15.7773 0.50001 15.5012C0.50001 15.225 0.723867 15.0012 1.00001 15.0012H12.0561C12.0574 15.0012 12.0587 15.0012 12.0599 15.0012C14.4748 14.999 16.5 12.8966 16.5 10.2703V10.2703C16.5 7.64266 14.4727 5.53948 12.0561 5.53948H12.0561H2.14215L5.09693 8.7397C5.28426 8.94258 5.27165 9.25891 5.06876 9.44624C4.86587 9.63357 4.54954 9.62096 4.36221 9.41807L0.632626 5.37869C0.539238 5.27754 0.495541 5.1482 0.50034 5.0207C0.494689 4.88432 0.544583 4.74615 0.649677 4.64301L4.44968 0.91342C4.64676 0.719992 4.96332 0.722952 5.15675 0.920032C5.35018 1.11711 5.34722 1.43368 5.15014 1.62711L2.18279 4.53948Z"
                  />
                </mask>
                <path
                  d="M2.18279 4.53948L1.48232 3.82579C1.19245 4.11029 1.10345 4.54187 1.25713 4.91784C1.4108 5.29381 1.77662 5.53948 2.18279 5.53948V4.53948ZM12.0521 16.0012L12.0598 15.0012H12.0521V16.0012ZM12.0599 15.0012L12.0525 16.0012L12.0609 16.0012L12.0599 15.0012ZM2.14215 5.53948V4.53948C1.74493 4.53948 1.38537 4.77458 1.22608 5.13846C1.06679 5.50234 1.13797 5.926 1.40743 6.21785L2.14215 5.53948ZM5.09693 8.7397L5.83165 8.06133L5.83165 8.06133L5.09693 8.7397ZM5.06876 9.44624L5.74713 10.181L5.74713 10.181L5.06876 9.44624ZM4.36221 9.41807L5.09693 8.7397L5.09693 8.7397L4.36221 9.41807ZM0.632626 5.37869L-0.102094 6.05706L-0.102093 6.05706L0.632626 5.37869ZM0.50034 5.0207L1.49963 5.05831C1.50062 5.03199 1.50057 5.00563 1.49948 4.97931L0.50034 5.0207ZM0.649677 4.64301L1.35014 5.35669L1.35014 5.35669L0.649677 4.64301ZM4.44968 0.91342L3.74921 0.199731L3.74921 0.199732L4.44968 0.91342ZM5.15675 0.920032L5.87044 0.219568L5.87044 0.219568L5.15675 0.920032ZM5.15014 1.62711L4.44968 0.913419L4.44968 0.913419L5.15014 1.62711ZM12.0561 3.53948H2.18279V5.53948H12.0561V3.53948ZM12.0561 3.53948H12.0561V5.53948H12.0561V3.53948ZM18.5 10.2703C18.5 6.64732 15.6834 3.53948 12.0561 3.53948V5.53948C14.4713 5.53948 16.5 7.64119 16.5 10.2703H18.5ZM18.5 10.2703V10.2703H16.5V10.2703H18.5ZM12.0561 17.0012C15.6834 17.0012 18.5 13.8933 18.5 10.2703H16.5C16.5 12.8995 14.4713 15.0012 12.0561 15.0012V17.0012ZM12.0443 17.0011C12.048 17.0012 12.052 17.0012 12.0561 17.0012V15.0012C12.0576 15.0012 12.0588 15.0012 12.0598 15.0012L12.0443 17.0011ZM12.0521 15.0012H1.00001V17.0012H12.0521V15.0012ZM1.00001 15.0012C1.27615 15.0012 1.50001 15.225 1.50001 15.5012H-0.49999C-0.49999 16.3296 0.171582 17.0012 1.00001 17.0012V15.0012ZM1.50001 15.5012C1.50001 15.7773 1.27615 16.0012 1.00001 16.0012V14.0012C0.171582 14.0012 -0.49999 14.6727 -0.49999 15.5012H1.50001ZM1.00001 16.0012H12.0561V14.0012H1.00001V16.0012ZM12.0561 16.0012C12.0549 16.0012 12.0537 16.0012 12.0525 16.0012L12.0674 14.0012C12.0636 14.0012 12.0598 14.0012 12.0561 14.0012V16.0012ZM15.5 10.2703C15.5 12.3966 13.8714 13.9995 12.059 14.0012L12.0609 16.0012C15.0782 15.9984 17.5 13.3966 17.5 10.2703H15.5ZM15.5 10.2703V10.2703H17.5V10.2703H15.5ZM12.0561 6.53948C13.8697 6.53948 15.5 8.14285 15.5 10.2703H17.5C17.5 7.14246 15.0756 4.53948 12.0561 4.53948V6.53948ZM12.0561 6.53948H12.0561V4.53948H12.0561V6.53948ZM2.14215 6.53948H12.0561V4.53948H2.14215V6.53948ZM5.83165 8.06133L2.87687 4.86111L1.40743 6.21785L4.36221 9.41807L5.83165 8.06133ZM5.74713 10.181C6.35579 9.61898 6.39363 8.66999 5.83165 8.06133L4.36221 9.41807C4.17489 9.21518 4.1875 8.89885 4.39039 8.71152L5.74713 10.181ZM3.62749 10.0964C4.18948 10.7051 5.13847 10.7429 5.74713 10.181L4.39039 8.71152C4.59327 8.5242 4.9096 8.53681 5.09693 8.7397L3.62749 10.0964ZM-0.102093 6.05706L3.62749 10.0964L5.09693 8.7397L1.36735 4.70031L-0.102093 6.05706ZM-0.498953 4.9831C-0.51329 5.36406 -0.382061 5.75383 -0.102094 6.05706L1.36735 4.70032C1.46054 4.80125 1.50437 4.93234 1.49963 5.05831L-0.498953 4.9831ZM-0.0507866 3.92932C-0.366114 4.2388 -0.515667 4.65503 -0.498803 5.0621L1.49948 4.97931C1.50505 5.1136 1.45528 5.2535 1.35014 5.35669L-0.0507866 3.92932ZM3.74921 0.199732L-0.0507868 3.92932L1.35014 5.35669L5.15014 1.62711L3.74921 0.199732ZM5.87044 0.219568C5.29016 -0.37167 4.34045 -0.380551 3.74921 0.199731L5.15014 1.62711C4.95306 1.82054 4.63649 1.81758 4.44306 1.6205L5.87044 0.219568ZM5.8506 2.3408C6.44184 1.76051 6.45072 0.810806 5.87044 0.219568L4.44306 1.6205C4.24964 1.42342 4.2526 1.10685 4.44968 0.913419L5.8506 2.3408ZM2.88325 5.25317L5.8506 2.3408L4.44968 0.913419L1.48232 3.82579L2.88325 5.25317Z"
                  fill="#3B3B3B"
                  mask="url(#path-1-inside-1)"
                />
              </svg>
            </div>`

        case 'PENDING':
          return `<div class="p-1.5 bg-blue-50 rounded-full">
              <svg
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M9.719 4.736V11.064L14.641 14M10 19C14.9706 19 19 14.9706 19 10C19 5.02944 14.9706 1 10 1C5.02944 1 1 5.02944 1 10C1 14.9706 5.02944 19 10 19Z"
                  stroke="#3B3B3B"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                />
              </svg>
            </div>`
      }
    },

    renderTransaction(transaction) {
      switch (transaction.status) {
        case 'COMPLETED':
          if (transaction.source === 'PAYMENT' && transaction.entry === 'DEBIT')
            return 'Pagamento Realizado'
          if (
            transaction.source === 'TRANSFER' &&
            transaction.entry === 'DEBIT'
          )
            return 'Transferência Realizada'
          if (
            transaction.source === 'PAYMENT' &&
            transaction.entry === 'CREDIT'
          )
            return 'Pagamento Recebido'
          if (
            transaction.source === 'TRANSFER' &&
            transaction.entry === 'CREDIT'
          )
            return 'Pagamento Realizado'
          break
        case 'REFUNDED':
          if (
            transaction.source === 'PAYMENT' &&
            transaction.entry === 'CREDIT'
          )
            return 'Pagamento Estornado'
          if (
            transaction.source === 'TRANSFER' &&
            transaction.entry === 'CREDIT'
          )
            return 'Transferência Estornada'
          break
        case 'PENDING':
          if (transaction.source === 'PAYMENT' && transaction.entry === 'DEBIT')
            return 'Pagamento Agendado'
          if (
            transaction.source === 'TRANSFER' &&
            transaction.entry === 'DEBIT'
          )
            return 'Transferência Agendado'
          break
      }
    },
    formatReal(int) {
      let tmp = int + ''
      tmp = tmp.replace(/([0-9]{2})$/g, ',$1')
      if (tmp.length > 6) tmp = tmp.replace(/([0-9]{3}),([0-9]{2}$)/g, '.$1,$2')

      return tmp
    },
  },
}
</script>

<template>
  <div>
    <div
      :class="[
        'grid',
        { 'grid-cols-4': itemPos === 0 },
        'items-center',
        'py-6',
        'pl-4',
        'pr-9',
        { 'grid-cols-2': itemPos > 0 },
      ]"
    >
      <div>
        <p class="font-black text-xs text-gray-800">
          {{ item.date && formatDate(item.date) }}
        </p>
      </div>
      <div v-if="itemPos === 0" class="text-center">
        <p class="text-sm text-gray-500">Tipo de transação</p>
      </div>
      <div v-if="itemPos === 0" class="text-center">
        <p class="font-black text-sm text-pink-500">Data</p>
      </div>
      <div v-if="itemPos === 0" class="text-right">
        <p class="text-sm text-gray-500">Valor</p>
      </div>
      <div v-if="itemPos > 0" class="text-right">
        <p class="text-sm text-gray-500">
          saldo do dia
          <span class="font-black text-gray-800">{{
            item.amountTotal && formatReal(item.amountTotal)
          }}</span>
        </p>
      </div>
    </div>
    <hr class="divider ml-2" />
    <div
      class="
        relative
        z-10
        border border-gray-300
        bg-white
        rounded-2xl
        pl-4
        py-7
        pr-9
      "
    >
      <div
        v-for="(_item, index) in item.items"
        :key="index"
        :class="[
          'grid',
          'grid-cols-4',
          'items-center',
          'gap-4',
          {
            'pb-7': item.items.length > 1 && index < item.items.length - 1,
          },
        ]"
      >
        <div class="flex items-center gap-2">
          <div v-html="renderTransactionIcon(_item.status)"></div>
          <p class="text-gray-500">{{ _item.actor }}</p>
        </div>
        <div class="text-center">
          <p class="text-gray-500">{{ renderTransaction(_item) }}</p>
        </div>
        <div class="col-start-3.5 text-center">
          <p class="text-gray-500 capitalize">
            {{ _item.dateEvent && formatDate(_item.dateEvent, 'hours') }}
          </p>
        </div>
        <div class="text-right">
          <p
            :class="[
              'text-gray-800',
              {
                'text-blue-400 font-extrabold':
                  _item.entry === 'CREDIT' && !_item.scheduled,
              },
              { 'line-through': _item.entry === 'DEBIT' && !_item.scheduled },
              { 'text-pink-500 font-extrabold': _item.scheduled },
            ]"
          >
            <span class="font-normal">{{
              _item.entry === 'CREDIT' ? '+' : _item.scheduled ? '-' : ''
            }}</span>
            <span class="font-normal">R$</span>
            {{ _item.amount && formatReal(_item.amount) }}
          </p>
        </div>
      </div>
    </div>
    <hr class="divider ml-2" />
  </div>
</template>

<style scoped>
.divider {
  transform: rotate(90deg);
  width: 28px;
  z-index: 1;
  position: absolute;
  /* left: 7.5%; */
}
</style>
